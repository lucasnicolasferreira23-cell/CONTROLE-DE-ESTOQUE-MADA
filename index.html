<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão MADA - Controle Avançado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#ff6b35',
                        'secondary': '#f7931e',
                        'dark-navy': '#0f172a',
                        'dark-slate': '#1e293b',
                        'success': '#10b981',
                        'warning': '#f59e0b',
                        'danger': '#ef4444',
                    }
                }
            }
        }
    </script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background: #0f172a;
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 107, 53, 0.1);
        }
        
        .sidebar-item {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            color: #cbd5e1;
        }
        
        .sidebar-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: linear-gradient(180deg, #ff6b35, #f7931e);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }
        
        .sidebar-item:hover::before,
        .sidebar-item.active::before {
            transform: scaleY(1);
        }
        
        .sidebar-item:hover {
            background: rgba(255, 107, 53, 0.1);
            transform: translateX(5px);
            color: #ff6b35;
        }
        
        .sidebar-item.active {
            background: linear-gradient(90deg, rgba(255, 107, 53, 0.15), transparent);
            font-weight: 600;
            color: #ff6b35;
        }
        
        .status-badge {
            padding: 0.375rem 0.875rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .status-solicitado {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
        }
        
        .status-iniciado {
            background: linear-gradient(135deg, #dbeafe, #93c5fd);
            color: #1e40af;
        }
        
        .status-concluido {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #065f46;
        }
        
        .status-pendente {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            color: #991b1b;
        }
        
        .status-em-andamento {
            background: linear-gradient(135deg, #dbeafe, #93c5fd);
            color: #1e40af;
        }
        
        .status-finalizado {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #065f46;
        }
        
        .status-aguardando {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            color: white;
            font-weight: 600;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.5);
        }
        
        .card {
            background: #1e293b;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 107, 53, 0.1);
        }
        
        .card:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            transform: translateY(-2px);
        }
        
        .progress-bar {
            height: 8px;
            background: #334155;
            border-radius: 9999px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b35, #f7931e);
            border-radius: 9999px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .observation-box {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(245, 158, 11, 0.2) 100%);
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .machine-label {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .machine-seccionadora {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }
        
        .machine-nanxing {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        input, textarea, select {
            background: #334155;
            color: #e2e8f0;
            border: 1px solid #475569;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #ff6b35;
            ring: 2px;
            ring-color: rgba(255, 107, 53, 0.3);
        }
        
        input::placeholder, textarea::placeholder {
            color: #64748b;
        }
        
        .delete-btn {
            transition: all 0.3s ease;
            background: #dc2626;
        }
        
        .delete-btn:hover {
            background: #b91c1c !important;
            transform: scale(1.05);
        }
        
        .phase-card {
            border: 2px solid #334155;
            border-radius: 0.75rem;
            padding: 1.25rem;
            transition: all 0.3s ease;
            background: rgba(30, 41, 59, 0.5);
        }
        
        .phase-card.active {
            border-color: #3b82f6;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.05));
        }
        
        .phase-card.completed {
            border-color: #10b981;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));
        }
        
        .collapsible-plan {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .collapsible-plan:hover {
            background: rgba(255, 107, 53, 0.05);
        }
        
        .plan-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .plan-content.expanded {
            max-height: 5000px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(247, 147, 30, 0.05));
            border: 1px solid rgba(255, 107, 53, 0.2);
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.2);
        }
        
        .text-light {
            color: #e2e8f0;
        }
        
        .text-muted {
            color: #94a3b8;
        }
        
        label {
            color: #cbd5e1;
        }
        
        h1, h2, h3, h4 {
            color: #f1f5f9;
        }
        
        table {
            color: #e2e8f0;
        }
        
        thead {
            background: rgba(255, 107, 53, 0.1) !important;
        }
        
        tbody tr:hover {
            background: rgba(255, 107, 53, 0.05) !important;
        }
    </style>
</head>
<body>
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <div class="w-72 glass-effect shadow-2xl no-print flex flex-col">
            <div class="p-6 border-b border-gray-700">
                <h1 class="text-2xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">
                    Sistema MADA
                </h1>
                <p class="text-gray-400 text-sm mt-1">Gestão Inteligente</p>
            </div>
            
            <nav class="flex-1 p-4">
                <ul class="space-y-2">
                    <li>
                        <button onclick="showSection('cadastro')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Cadastro
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('sobras')" class="sidebar-item active w-full text-left px-4 py-3 rounded-lg flex items-center">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                            </svg>
                            Sobras
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('plano-corte')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                            Plano de Corte
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('solicitacoes')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                            </svg>
                            Solicitações
                        </button>
                    </li>
                </ul>
            </nav>
            
            <div class="p-4 border-t border-gray-700">
                <div class="text-xs text-gray-400">
                    <div class="font-semibold text-gray-300">Usuário Ativo</div>
                    <div class="mt-1">ID: <span id="user-id">ADMIN</span></div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-auto">
            <header class="glass-effect px-8 py-6 no-print shadow-lg">
                <h1 class="text-3xl font-bold text-light">Sistema de Gestão MADA</h1>
                <p class="text-muted mt-1">Controle completo de materiais e produção</p>
            </header>

            <main class="p-8">
                <!-- Seção Cadastro -->
                <section id="section-cadastro" class="space-y-6 hidden">
                    <div class="card p-8">
                        <h2 class="text-2xl font-bold text-light mb-6">Cadastrar Material</h2>
                        <form id="material-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">NOME DO MDF</label>
                                <input type="text" id="nome" required class="w-full px-4 py-3 rounded-lg">
                            </div>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">COMPRIMENTO (mm)</label>
                                    <input type="number" id="comprimento" required class="w-full px-4 py-3 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">LARGURA (mm)</label>
                                    <input type="number" id="largura" required class="w-full px-4 py-3 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">ESPESSURA (mm)</label>
                                    <input type="number" id="espessura" required class="w-full px-4 py-3 rounded-lg">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">QUANTIDADE</label>
                                    <input type="number" id="quantidade" required class="w-full px-4 py-3 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">LOCALIZAÇÃO</label>
                                    <input type="text" id="localizacao" class="w-full px-4 py-3 rounded-lg">
                                </div>
                            </div>
                            <button type="submit" class="btn-primary w-full py-4 px-6 rounded-lg">
                                Cadastrar Material
                            </button>
                        </form>
                    </div>

                    <div class="card p-8">
                        <h2 class="text-2xl font-bold text-light mb-6">Criar Plano de Corte</h2>
                        <form id="plano-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">NOME DO LOTE</label>
                                <input type="text" id="nome-lote" placeholder="Ex: LOTE-001" required class="w-full px-4 py-3 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">CLIENTE/AMBIENTE</label>
                                <textarea id="cliente-ambiente" rows="3" placeholder="Ex: João Silva - Cozinha, Sala" required class="w-full px-4 py-3 rounded-lg"></textarea>
                            </div>
                            <button type="submit" class="btn-primary w-full py-4 px-6 rounded-lg">
                                Criar Plano de Corte
                            </button>
                        </form>
                    </div>
                </section>

                <!-- Seção Sobras -->
                <section id="section-sobras" class="space-y-6">
                    <div class="card p-8">
                        <h2 class="text-2xl font-bold text-light mb-6">Gestão de Sobras</h2>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr>
                                        <th class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider">Nome</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider">Comprimento</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider">Largura</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider">Espessura</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider">Quantidade</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider">Localização</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="sobras-table" class="divide-y divide-gray-700">
                                    <tr>
                                        <td colspan="7" class="px-6 py-12 text-center text-gray-400">Nenhum material cadastrado</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Seção Plano de Corte -->
                <section id="section-plano-corte" class="space-y-6 hidden">
                    <div class="card p-8">
                        <h2 class="text-2xl font-bold text-light mb-6">Planos de Corte Ativos</h2>
                        <div id="planos-list" class="space-y-4">
                            <div class="text-center text-gray-400 py-12">Nenhum plano de corte criado</div>
                        </div>
                    </div>
                </section>

                <!-- Seção Solicitações -->
                <section id="section-solicitacoes" class="space-y-6 hidden">
                    <div class="card p-8">
                        <h2 class="text-2xl font-bold text-light mb-6">Nova Solicitação</h2>
                        <form id="solicitacao-form" class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">CLIENTE</label>
                                    <input type="text" id="sol-cliente" required class="w-full px-4 py-3 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">AMBIENTE</label>
                                    <input type="text" id="sol-ambiente" required class="w-full px-4 py-3 rounded-lg">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">NÚMERO DA PEÇA</label>
                                    <input type="text" id="sol-peca" required class="w-full px-4 py-3 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">MARCENEIRO</label>
                                    <input type="text" id="sol-marceneiro" required class="w-full px-4 py-3 rounded-lg">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">OBSERVAÇÃO</label>
                                <textarea id="sol-observacao" rows="3" class="w-full px-4 py-3 rounded-lg"></textarea>
                            </div>
                            <button type="submit" class="btn-primary w-full py-4 px-6 rounded-lg">
                                Criar Solicitação
                            </button>
                        </form>
                    </div>

                    <!-- Painel de Estatísticas -->
                    <div id="stats-panel" class="hidden">
                        <div class="card p-8">
                            <h2 class="text-2xl font-bold text-light mb-6">📊 Análise de Problemas</h2>
                            <div class="grid grid-cols-3 gap-6">
                                <div class="stat-card text-center">
                                    <div class="text-4xl font-bold text-primary mb-2" id="stat-industria">0</div>
                                    <div class="text-sm text-muted font-semibold uppercase">Indústria</div>
                                    <div class="text-xs text-gray-500 mt-1" id="percent-industria">0%</div>
                                </div>
                                <div class="stat-card text-center">
                                    <div class="text-4xl font-bold text-secondary mb-2" id="stat-engenharia">0</div>
                                    <div class="text-sm text-muted font-semibold uppercase">Engenharia</div>
                                    <div class="text-xs text-gray-500 mt-1" id="percent-engenharia">0%</div>
                                </div>
                                <div class="stat-card text-center">
                                    <div class="text-4xl font-bold text-warning mb-2" id="stat-marceneiro">0</div>
                                    <div class="text-sm text-muted font-semibold uppercase">Marceneiro</div>
                                    <div class="text-xs text-gray-500 mt-1" id="percent-marceneiro">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card p-8">
                        <h2 class="text-2xl font-bold text-light mb-6">Solicitações Ativas</h2>
                        <div id="solicitacoes-list" class="space-y-4">
                            <div class="text-center text-gray-400 py-12">Nenhuma solicitação criada</div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script>
        // Sistema de armazenamento
        const DB = {
            materiais: JSON.parse(localStorage.getItem('materiais') || '[]'),
            planos: JSON.parse(localStorage.getItem('planos') || '[]'),
            solicitacoes: JSON.parse(localStorage.getItem('solicitacoes') || '[]'),
            
            save() {
                localStorage.setItem('materiais', JSON.stringify(this.materiais));
                localStorage.setItem('planos', JSON.stringify(this.planos));
                localStorage.setItem('solicitacoes', JSON.stringify(this.solicitacoes));
            }
        };

        // Navegação
        function showSection(section) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
            
            document.getElementById(`section-${section}`).classList.remove('hidden');
            event.target.closest('.sidebar-item').classList.add('active');
            
            if (section === 'sobras') loadSobras();
            if (section === 'plano-corte') loadPlanos();
            if (section === 'solicitacoes') {
                loadSolicitacoes();
                updateStats();
            }
        }

        // Cadastro de Material
        document.getElementById('material-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const material = {
                id: Date.now(),
                nome: document.getElementById('nome').value,
                comprimento: document.getElementById('comprimento').value,
                largura: document.getElementById('largura').value,
                espessura: document.getElementById('espessura').value,
                quantidade: document.getElementById('quantidade').value,
                localizacao: document.getElementById('localizacao').value,
                data: new Date().toLocaleDateString('pt-BR')
            };
            
            DB.materiais.push(material);
            DB.save();
            
            alert('Material cadastrado com sucesso!');
            e.target.reset();
            loadSobras();
        });

        // Criar Plano de Corte
        document.getElementById('plano-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const plano = {
                id: Date.now(),
                nome: document.getElementById('nome-lote').value,
                cliente: document.getElementById('cliente-ambiente').value,
                status: 'aguardando',
                expanded: false,
                fases: {
                    corte: {
                        status: 'pendente',
                        seccionadora: { obs: '' },
                        nanxing: { obs: '' }
                    },
                    filetacao: {
                        status: 'pendente',
                        obs: ''
                    },
                    usinagem: {
                        status: 'pendente',
                        obs: ''
                    }
                },
                criado: new Date().toISOString()
            };
            
            DB.planos.push(plano);
            DB.save();
            
            alert('Plano de corte criado com sucesso!');
            e.target.reset();
            loadPlanos();
        });

        // Criar Solicitação
        document.getElementById('solicitacao-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const solicitacao = {
                id: Date.now(),
                cliente: document.getElementById('sol-cliente').value,
                ambiente: document.getElementById('sol-ambiente').value,
                peca: document.getElementById('sol-peca').value,
                marceneiro: document.getElementById('sol-marceneiro').value,
                observacao: document.getElementById('sol-observacao').value,
                status: 'solicitado',
                problema: null,
                resolucao: '',
                criado: new Date().toISOString()
            };
            
            DB.solicitacoes.push(solicitacao);
            DB.save();
            
            alert('Solicitação criada com sucesso!');
            e.target.reset();
            loadSolicitacoes();
            updateStats();
        });

        // Carregar Sobras
        function loadSobras() {
            const tbody = document.getElementById('sobras-table');
            
            if (DB.materiais.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="px-6 py-12 text-center text-gray-400">Nenhum material cadastrado</td></tr>';
                return;
            }
            
            tbody.innerHTML = DB.materiais.map(m => `
                <tr class="transition">
                    <td class="px-6 py-4 font-medium">${m.nome}</td>
                    <td class="px-6 py-4">${m.comprimento}mm</td>
                    <td class="px-6 py-4">${m.largura}mm</td>
                    <td class="px-6 py-4">${m.espessura}mm</td>
                    <td class="px-6 py-4">${m.quantidade}</td>
                    <td class="px-6 py-4">${m.localizacao || '-'}</td>
                    <td class="px-6 py-4">
                        <button onclick="deleteMaterial(${m.id})" class="delete-btn text-white px-4 py-2 rounded-lg text-sm font-semibold">
                            Excluir
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Toggle Plano
        function togglePlano(planoId) {
            const plano = DB.planos.find(p => p.id === planoId);
            plano.expanded = !plano.expanded;
            DB.save();
            loadPlanos();
        }

        // Carregar Planos (com collapse)
        function loadPlanos() {
            const container = document.getElementById('planos-list');
            
            if (DB.planos.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-12">Nenhum plano de corte criado</div>';
                return;
            }
            
            container.innerHTML = DB.planos.map(plano => {
                const progress = calcularProgresso(plano);
                const isExpanded = plano.expanded;
                
                return `
                    <div class="border-2 border-gray-700 rounded-xl overflow-hidden">
                        <!-- Header Colapsável -->
                        <div onclick="togglePlano(${plano.id})" class="collapsible-plan p-6 flex justify-between items-center">
                            <div class="flex-1">
                                <div class="flex items-center gap-4">
                                    <svg class="w-5 h-5 text-primary transition-transform ${isExpanded ? 'rotate-90' : ''}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                    <div>
                                        <h3 class="text-xl font-bold text-light">${plano.nome}</h3>
                                        <p class="text-muted mt-1">${plano.cliente}</p>
                                    </div>
                                </div>
                                <div class="mt-4 space-y-2 ml-9">
                                    <div class="flex justify-between text-sm text-muted">
                                        <span>Progresso Geral</span>
                                        <span class="font-semibold">${progress}%</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${progress}%"></div>
                                    </div>
                                </div>
                            </div>
                            <button onclick="event.stopPropagation(); deletePlano(${plano.id})" class="delete-btn text-white px-4 py-2 rounded-lg text-sm font-semibold ml-4">
                                Excluir
                            </button>
                        </div>
                        
                        <!-- Conteúdo Expansível -->
                        <div class="plan-content ${isExpanded ? 'expanded' : ''}" id="plan-${plano.id}">
                            <div class="p-6 pt-0 space-y-6">
                                
                                <!-- CORTE -->
                                <div class="phase-card ${plano.fases.corte.status === 'em-andamento' ? 'active' : plano.fases.corte.status === 'finalizado' ? 'completed' : ''}">
                                    <div class="flex justify-between items-center mb-4">
                                        <h4 class="text-lg font-bold text-light">🔪 CORTE</h4>
                                        <span class="status-badge status-${plano.fases.corte.status}">${plano.fases.corte.status}</span>
                                    </div>
                                    
                                    ${plano.fases.corte.status === 'pendente' ? `
                                        <button onclick="iniciarFase(${plano.id}, 'corte')" class="btn-primary w-full py-3 px-6 rounded-lg">
                                            Iniciar Corte
                                        </button>
                                    ` : ''}
                                    
                                    ${plano.fases.corte.status === 'em-andamento' ? `
                                        <div class="space-y-4">
                                            <div>
                                                <label class="machine-label machine-seccionadora">SECCIONADORA</label>
                                                <textarea 
                                                    id="obs-sec-${plano.id}" 
                                                    placeholder="Observações da Seccionadora..." 
                                                    class="w-full mt-2 px-4 py-3 rounded-lg"
                                                    rows="2"
                                                >${plano.fases.corte.seccionadora.obs}</textarea>
                                            </div>
                                            
                                            <div>
                                                <label class="machine-label machine-nanxing">NANXING</label>
                                                <textarea 
                                                    id="obs-nan-${plano.id}" 
                                                    placeholder="Observações da Nanxing..." 
                                                    class="w-full mt-2 px-4 py-3 rounded-lg"
                                                    rows="2"
                                                >${plano.fases.corte.nanxing.obs}</textarea>
                                            </div>
                                            
                                            <button onclick="finalizarFase(${plano.id}, 'corte')" class="btn-primary w-full py-3 px-6 rounded-lg">
                                                Finalizar Corte
                                            </button>
                                        </div>
                                    ` : ''}
                                    
                                    ${plano.fases.corte.status === 'finalizado' ? `
                                        <div class="space-y-2">
                                            ${plano.fases.corte.seccionadora.obs ? `
                                                <div class="observation-box">
                                                    <div class="machine-label machine-seccionadora mb-2">SECCIONADORA</div>
                                                    <p class="text-gray-300 text-sm">${plano.fases.corte.seccionadora.obs}</p>
                                                </div>
                                            ` : ''}
                                            ${plano.fases.corte.nanxing.obs ? `
                                                <div class="observation-box">
                                                    <div class="machine-label machine-nanxing mb-2">NANXING</div>
                                                    <p class="text-gray-300 text-sm">${plano.fases.corte.nanxing.obs}</p>
                                                </div>
                                            ` : ''}
                                        </div>
                                    ` : ''}
                                </div>

                                <!-- FILETAÇÃO -->
                                <div class="phase-card ${plano.fases.filetacao.status === 'em-andamento' ? 'active' : plano.fases.filetacao.status === 'finalizado' ? 'completed' : ''}">
                                    <div class="flex justify-between items-center mb-4">
                                        <h4 class="text-lg font-bold text-light">📏 FILETAÇÃO</h4>
                                        <span class="status-badge status-${plano.fases.filetacao.status}">${plano.fases.filetacao.status}</span>
                                    </div>
                                    
                                    ${plano.fases.filetacao.status === 'pendente' && plano.fases.corte.status === 'finalizado' ? `
                                        <button onclick="iniciarFase(${plano.id}, 'filetacao')" class="btn-primary w-full py-3 px-6 rounded-lg">
                                            Iniciar Filetação
                                        </button>
                                    ` : ''}
                                    
                                    ${plano.fases.filetacao.status === 'em-andamento' ? `
                                        <div class="space-y-4">
                                            <textarea 
                                                id="obs-fil-${plano.id}" 
                                                placeholder="Observações da Filetação..." 
                                                class="w-full px-4 py-3 rounded-lg"
                                                rows="2"
                                            >${plano.fases.filetacao.obs}</textarea>
                                            
                                            <button onclick="finalizarFase(${plano.id}, 'filetacao')" class="btn-primary w-full py-3 px-6 rounded-lg">
                                                Finalizar Filetação
                                            </button>
                                        </div>
                                    ` : ''}
                                    
                                    ${plano.fases.filetacao.status === 'finalizado' && plano.fases.filetacao.obs ? `
                                        <div class="observation-box">
                                            <p class="text-gray-300 text-sm">${plano.fases.filetacao.obs}</p>
                                        </div>
                                    ` : ''}
                                </div>

                                <!-- USINAGEM -->
                                <div class="phase-card ${plano.fases.usinagem.status === 'em-andamento' ? 'active' : plano.fases.usinagem.status === 'finalizado' ? 'completed' : ''}">
                                    <div class="flex justify-between items-center mb-4">
                                        <h4 class="text-lg font-bold text-light">⚙️ USINAGEM</h4>
                                        <span class="status-badge status-${plano.fases.usinagem.status}">${plano.fases.usinagem.status}</span>
                                    </div>
                                    
                                    ${plano.fases.usinagem.status === 'pendente' && plano.fases.filetacao.status === 'finalizado' ? `
                                        <button onclick="iniciarFase(${plano.id}, 'usinagem')" class="btn-primary w-full py-3 px-6 rounded-lg">
                                            Iniciar Usinagem
                                        </button>
                                    ` : ''}
                                    
                                    ${plano.fases.usinagem.status === 'em-andamento' ? `
                                        <div class="space-y-4">
                                            <textarea 
                                                id="obs-usi-${plano.id}" 
                                                placeholder="Observações da Usinagem..." 
                                                class="w-full px-4 py-3 rounded-lg"
                                                rows="2"
                                            >${plano.fases.usinagem.obs}</textarea>
                                            
                                            <button onclick="finalizarFase(${plano.id}, 'usinagem')" class="btn-primary w-full py-3 px-6 rounded-lg">
                                                Finalizar Usinagem
                                            </button>
                                        </div>
                                    ` : ''}
                                    
                                    ${plano.fases.usinagem.status === 'finalizado' ? `
                                        ${plano.fases.usinagem.obs ? `
                                            <div class="observation-box">
                                                <p class="text-gray-300 text-sm">${plano.fases.usinagem.obs}</p>
                                            </div>
                                        ` : ''}
                                        <div class="mt-4 p-4 bg-green-900/30 border-2 border-green-500 rounded-lg text-center">
                                            <p class="text-green-400 font-bold text-lg">✓ Plano Concluído!</p>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Atualizar estatísticas
        function updateStats() {
            const solicitacoesComProblema = DB.solicitacoes.filter(s => s.problema);
            const total = solicitacoesComProblema.length;
            
            if (total === 0) {
                document.getElementById('stats-panel').classList.add('hidden');
                return;
            }
            
            document.getElementById('stats-panel').classList.remove('hidden');
            
            const industria = solicitacoesComProblema.filter(s => s.problema === 'industria').length;
            const engenharia = solicitacoesComProblema.filter(s => s.problema === 'engenharia').length;
            const marceneiro = solicitacoesComProblema.filter(s => s.problema === 'marceneiro').length;
            
            document.getElementById('stat-industria').textContent = industria;
            document.getElementById('stat-engenharia').textContent = engenharia;
            document.getElementById('stat-marceneiro').textContent = marceneiro;
            
            document.getElementById('percent-industria').textContent = `${((industria/total)*100).toFixed(1)}%`;
            document.getElementById('percent-engenharia').textContent = `${((engenharia/total)*100).toFixed(1)}%`;
            document.getElementById('percent-marceneiro').textContent = `${((marceneiro/total)*100).toFixed(1)}%`;
        }

        // Carregar Solicitações
        function loadSolicitacoes() {
            const container = document.getElementById('solicitacoes-list');
            
            if (DB.solicitacoes.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-12">Nenhuma solicitação criada</div>';
                return;
            }
            
            container.innerHTML = DB.solicitacoes.map(sol => `
                <div class="border-2 border-gray-700 rounded-xl p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-3">
                                <h3 class="text-lg font-bold text-light">${sol.cliente} - ${sol.ambiente}</h3>
                                <span class="status-badge status-${sol.status}">${sol.status}</span>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div>
                                    <span class="text-muted">Peça:</span>
                                    <span class="font-semibold text-light"> ${sol.peca}</span>
                                </div>
                                <div>
                                    <span class="text-muted">Marceneiro:</span>
                                    <span class="font-semibold text-light"> ${sol.marceneiro}</span>
                                </div>
                            </div>
                            ${sol.observacao ? `
                                <div class="mt-3 observation-box">
                                    <p class="text-gray-300 text-sm">${sol.observacao}</p>
                                </div>
                            ` : ''}
                        </div>
                        <button onclick="deleteSolicitacao(${sol.id})" class="delete-btn text-white px-4 py-2 rounded-lg text-sm font-semibold ml-4">
                            Excluir
                        </button>
                    </div>

                    ${sol.status === 'solicitado' ? `
                        <button onclick="iniciarSolicitacao(${sol.id})" class="btn-primary w-full py-3 px-6 rounded-lg">
                            Iniciar Atendimento
                        </button>
                    ` : ''}

                    ${sol.status === 'iniciado' ? `
                        <div class="space-y-4 mt-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">Local do Problema:</label>
                                <select id="problema-${sol.id}" class="w-full px-4 py-3 rounded-lg">
                                    <option value="">Selecione...</option>
                                    <option value="industria" ${sol.problema === 'industria' ? 'selected' : ''}>INDÚSTRIA</option>
                                    <option value="engenharia" ${sol.problema === 'engenharia' ? 'selected' : ''}>ENGENHARIA</option>
                                    <option value="marceneiro" ${sol.problema === 'marceneiro' ? 'selected' : ''}>MARCENEIRO</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Como foi resolvido:</label>
                                <textarea 
                                    id="resolucao-${sol.id}" 
                                    rows="3" 
                                    class="w-full px-4 py-3 rounded-lg"
                                    placeholder="Descreva como o problema foi resolvido..."
                                >${sol.resolucao}</textarea>
                            </div>
                            <button onclick="concluirSolicitacao(${sol.id})" class="btn-primary w-full py-3 px-6 rounded-lg">
                                Concluir Solicitação
                            </button>
                        </div>
                    ` : ''}

                    ${sol.status === 'concluido' ? `
                        <div class="mt-4 space-y-3">
                            ${sol.problema ? `
                                <div class="p-4 bg-yellow-900/30 border-l-4 border-yellow-500 rounded">
                                    <p class="text-sm text-light"><span class="font-semibold">Problema identificado em:</span> ${sol.problema.toUpperCase()}</p>
                                </div>
                            ` : ''}
                            ${sol.resolucao ? `
                                <div class="p-4 bg-green-900/30 border-l-4 border-green-500 rounded">
                                    <p class="text-sm font-semibold mb-1 text-light">Resolução:</p>
                                    <p class="text-sm text-gray-300">${sol.resolucao}</p>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // Funções de Plano de Corte
        function calcularProgresso(plano) {
            let total = 0;
            if (plano.fases.corte.status === 'finalizado') total += 33;
            if (plano.fases.filetacao.status === 'finalizado') total += 33;
            if (plano.fases.usinagem.status === 'finalizado') total += 34;
            return total;
        }

        function iniciarFase(planoId, fase) {
            const plano = DB.planos.find(p => p.id === planoId);
            plano.fases[fase].status = 'em-andamento';
            DB.save();
            loadPlanos();
        }

        function finalizarFase(planoId, fase) {
            const plano = DB.planos.find(p => p.id === planoId);
            
            if (fase === 'corte') {
                const obsSec = document.getElementById(`obs-sec-${planoId}`).value;
                const obsNan = document.getElementById(`obs-nan-${planoId}`).value;
                plano.fases.corte.seccionadora.obs = obsSec;
                plano.fases.corte.nanxing.obs = obsNan;
            } else {
                const obs = document.getElementById(`obs-${fase === 'filetacao' ? 'fil' : 'usi'}-${planoId}`).value;
                plano.fases[fase].obs = obs;
            }
            
            plano.fases[fase].status = 'finalizado';
            DB.save();
            loadPlanos();
        }

        function deletePlano(id) {
            if (confirm('Tem certeza que deseja excluir este plano de corte?')) {
                DB.planos = DB.planos.filter(p => p.id !== id);
                DB.save();
                loadPlanos();
            }
        }

        // Funções de Solicitação
        function iniciarSolicitacao(id) {
            const sol = DB.solicitacoes.find(s => s.id === id);
            sol.status = 'iniciado';
            DB.save();
            loadSolicitacoes();
        }

        function concluirSolicitacao(id) {
            const sol = DB.solicitacoes.find(s => s.id === id);
            const problema = document.getElementById(`problema-${id}`).value;
            const resolucao = document.getElementById(`resolucao-${id}`).value;
            
            if (!problema || !resolucao) {
                alert('Por favor, preencha o local do problema e a resolução.');
                return;
            }
            
            sol.problema = problema;
            sol.resolucao = resolucao;
            sol.status = 'concluido';
            DB.save();
            loadSolicitacoes();
            updateStats();
        }

        function deleteSolicitacao(id) {
            if (confirm('Tem certeza que deseja excluir esta solicitação?')) {
                DB.solicitacoes = DB.solicitacoes.filter(s => s.id !== id);
                DB.save();
                loadSolicitacoes();
                updateStats();
            }
        }

        // Função de deletar material
        function deleteMaterial(id) {
            if (confirm('Tem certeza que deseja excluir este material?')) {
                DB.materiais = DB.materiais.filter(m => m.id !== id);
                DB.save();
                loadSobras();
            }
        }

        // Carregar dados iniciais
        loadSobras();
    </script>
</body>
</html>
